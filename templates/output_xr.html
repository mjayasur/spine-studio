<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>XR Output - Compression Fracture Detection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@700&display=swap" rel="stylesheet">
    <style>
        /* General Styles */
        body {
            font-family: 'DM Sans', sans-serif;
            margin: 0;
            padding: 0 0 40px 0;
            background: #ffffff;
        }

        .main-content {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            padding-top: 100px;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #151439;
            margin-bottom: 20px;
        }

        .dropdown {
            margin-bottom: 20px;
        }

        .dropdown label {
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            color: #757575;
            display: block;
        }

        .dropdown select {
            margin-top: 10px;
            padding: 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            color: #757575;
            border: 1px solid #000000;
            border-radius: 5px;
            width: 100%;
        }

        .calculate-button {
            margin-top: 20px;
            padding: 10px 20px;
            border-radius: 32px;
            font-size: 14px;
            border: 2px solid #151439;
            background-color: transparent;
            color: #151439;
            text-transform: uppercase;
            cursor: pointer;
        }

        .calculate-button:hover {
            background-color: #151439;
            color: #ffffff;
        }

        .result-box {
            margin-top: 30px;
            padding: 20px;
            background: #EBEAED;
            border: 1px solid #000000;
            border-radius: 23px;
        }

        .result-box img {
            max-height: 500px;
            width: auto;
            border: 1px solid #000000;
            display: block;
            margin: 20px auto;
        }

        .result-box h2 {
            font-size: 20px;
            color: #757575;
            text-align: center;
        }

        .highlight {
            color: rgb(255, 0, 0);
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="output-xr-content">
        <header class="header">
            <div class="logo">
                <a href="/"><img src="{{ url_for('static', filename='images/image 1.png') }}" alt="Logo"> </a>
            </div>
            <nav>
                <ul>
                    <li><a href="/index.html">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/users.html">Users</a></li>
                    <li><a href="/contact.html">Contact Us</a></li>
                </ul>
            </nav>
        </header>
        <main class="main-content">
            <!-- Compression Fracture Detection Section -->
            <div class="section">
                <div class="section-title">Compression Fracture Detection</div>
                <div class="dropdown">
                    <label for="vertebrae-compression">Select Vertebra (L1-L5)</label>
                    <select id="vertebrae-compression">
                        <option value="L1">L1</option>
                        <option value="L2">L2</option>
                        <option value="L3">L3</option>
                        <option value="L4">L4</option>
                        <option value="L5">L5</option>
                    </select>
                </div>
                <button class="calculate-button" onclick="calculateCompressionFracture()">Calculate</button>
                <div id="compression-result" class="result-box" style="display: none;">
                    <h2>Compression Fracture Results</h2>
                    <img src="" id="compression-image" alt="Compression Fracture Image">
                    <p>Height Loss: <span class="highlight" id="height-loss">0%</span></p>
                    <p>Genant Classification: <span class="highlight" id="genant-classification">No compression
                            fracture</span></p>
                </div>
            </div>

            <!-- Spondylolisthesis Detection Section -->
            <div class="section">
                <div class="section-title">Spondylolisthesis Detection</div>
                <button class="calculate-button" onclick="calculateSpondylolisthesis()">Calculate</button>
                <div id="spondylolisthesis-result" class="result-box" style="display: none;">
                    <img src="" id="spondylolisthesis-image" alt="Spondylolisthesis Image">
                    <p>Percent Slipped: <span class="highlight" id="slippage-percentage">0%</span></p>
                    <p>Meyerding Classification: <span class="highlight" id="meyerding-classification">Grade I</span>
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script>
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            return { id };
        }

        function calculateCompressionFracture() {
            const vertebrae = document.getElementById('vertebrae-compression').value;
            const { id } = getUrlParams();

            fetch(`/calculate-compression-fracture?id=${id}&vertebrae=${vertebrae}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('compression-image').src = data.imageUrl;
                        document.getElementById('height-loss').textContent = data.heightLoss;
                        document.getElementById('genant-classification').textContent = data.genantClassification;

                        document.getElementById('compression-result').style.display = 'block';
                    } else {
                        alert(data.message || 'An error occurred while processing your request.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function calculateSpondylolisthesis() {
            const { id } = getUrlParams();

            fetch(`/calculate-spondylolisthesis?id=${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('spondylolisthesis-image').src = data.imageUrl;
                        document.getElementById('slippage-percentage').textContent = data.slippagePercentage;
                        document.getElementById('meyerding-classification').textContent = data.meyerdingClassification;

                        document.getElementById('spondylolisthesis-result').style.display = 'block';
                    } else {
                        alert(data.message || 'An error occurred while processing your request.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>